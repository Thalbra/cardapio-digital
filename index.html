<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card√°pio Digital Pro - Admin Full</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Poppins:wght@400;700&family=Roboto:wght@400;700&family=Montserrat:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --p-color: #059669; --bg-color: #f3f4f6; --font-size-base: 16px; }
        body { background-color: var(--bg-color); font-size: var(--font-size-base); transition: 0.3s; }
        .btn-primary { background-color: var(--p-color); }
        .selected-card { border: 4px solid var(--p-color) !important; transform: scale(1.02); }
        .hidden { display: none; }
        .card-item { background-color: #ffffff; }
        input[type="checkbox"]:checked { accent-color: var(--p-color); }
    </style>
</head>
<body class="font-['Inter']">

    <main id="app-menu" class="max-w-md mx-auto min-h-screen pb-24 shadow-lg">
        <header id="header-banner" class="h-52 bg-cover bg-center mb-4 shadow-inner border-b-4 border-[var(--p-color)]"></header>
        
        <div class="px-6">
            <h1 id="res-name-display" class="text-3xl font-black mb-1">Nome do Restaurante</h1>
            <a id="insta-link-display" href="#" target="_blank" class="text-pink-600 font-bold flex items-center gap-2 mb-6">
                <span>üì∏ Siga no Instagram</span>
            </a>

            <div class="mb-8 bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
                <label class="block text-sm font-bold text-gray-700 mb-2 uppercase tracking-wide">Seu Nome (Obrigat√≥rio)</label>
                <input type="text" id="client-name" placeholder="Digite seu nome para liberar o pedido" class="w-full p-4 rounded-xl border-2 border-gray-100 focus:border-[var(--p-color)] outline-none transition-all">
            </div>

            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">üçΩÔ∏è Escolha seu Prato</h2>
            <div id="pratos-container" class="grid gap-4"></div>

            <div id="acc-section" class="mt-8 hidden">
                <h2 class="text-xl font-bold mb-4">ü•ó Acompanhamentos exclusivos</h2>
                <div id="acc-container" class="grid gap-3"></div>
            </div>
        </div>

        <button id="btn-enviar" disabled class="fixed bottom-6 left-6 right-6 btn-primary text-white py-5 rounded-2xl font-black text-xl shadow-2xl uppercase tracking-widest transition-all opacity-50">
            Enviar Pedido
        </button>
    </main>

    <section id="admin-panel" class="hidden fixed inset-0 bg-gray-100 z-[200] overflow-y-auto p-4 font-['Inter']">
        <div class="max-w-xl mx-auto bg-white p-6 rounded-3xl shadow-2xl mb-10">
            <div class="flex justify-between items-center mb-8 border-b pb-4">
                <h2 class="text-2xl font-bold">‚öôÔ∏è CMS Administrativo</h2>
                <button onclick="toggleAdmin()" class="bg-red-100 text-red-600 px-4 py-2 rounded-lg font-bold">Sair</button>
            </div>

            <div class="space-y-8">
                <div class="bg-blue-50 p-4 rounded-2xl">
                    <p class="font-bold text-blue-800 mb-4 flex items-center gap-2">üé® Design e Cores</p>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs font-bold uppercase">Cor Prim√°ria</label>
                            <input type="color" id="adm-color-p" class="w-full h-10 rounded-lg cursor-pointer">
                        </div>
                        <div>
                            <label class="text-xs font-bold uppercase">Fundo do Site</label>
                            <input type="color" id="adm-color-bg" class="w-full h-10 rounded-lg cursor-pointer">
                        </div>
                        <div>
                            <label class="text-xs font-bold uppercase">Fonte Principal</label>
                            <select id="adm-font" class="w-full p-2 border rounded-lg">
                                <option value="'Inter'">Inter</option>
                                <option value="'Poppins'">Poppins</option>
                                <option value="'Roboto'">Roboto</option>
                                <option value="'Montserrat'">Montserrat</option>
                                <option value="'Lato'">Lato</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs font-bold uppercase">Tam. Fonte (px)</label>
                            <input type="number" id="adm-font-size" class="w-full p-2 border rounded-lg" value="16">
                        </div>
                    </div>
                </div>

                <div class="bg-gray-50 p-4 rounded-2xl">
                    <p class="font-bold mb-4">üìù Informa√ß√µes B√°sicas</p>
                    <input type="text" id="adm-name" placeholder="Nome do Restaurante" class="w-full p-3 rounded border mb-3">
                    <input type="text" id="adm-banner" placeholder="URL da Imagem de Capa (Banner)" class="w-full p-3 rounded border mb-3">
                    <input type="text" id="adm-insta" placeholder="URL do Instagram" class="w-full p-3 rounded border">
                </div>

                <div class="bg-gray-50 p-4 rounded-2xl">
                    <p class="font-bold mb-4">üçõ Editar Pratos e Acompanhamentos</p>
                    <div id="adm-pratos-list" class="space-y-6">
                        </div>
                </div>

                <div class="pt-4 sticky bottom-0 bg-white pb-4">
                    <button onclick="saveAdmin()" class="w-full bg-green-600 hover:bg-green-700 text-white py-5 rounded-2xl font-black text-lg shadow-lg transition-all">
                        SALVAR TODAS AS ALTERA√á√ïES
                    </button>
                    <button onclick="resetSystem()" class="w-full mt-4 text-red-500 text-sm underline font-bold">Resetar pedidos neste aparelho</button>
                </div>
            </div>
        </div>
    </section>

    <div onclick="checkAdmin()" class="fixed top-0 right-0 w-16 h-16 cursor-pointer z-[50] opacity-0 hover:opacity-10 bg-black rounded-bl-full transition-all"></div>

    <script>
        const WEBHOOK = "https://script.google.com/macros/s/AKfycbzaOMq4-v2vqsjS1USBrupBqMoGQlRLGUiPdGaC-OM1XolaQ1YosBF563Ylz26f6QSSiQ/exec";

        let state = JSON.parse(localStorage.getItem('db_menu_v2')) || {
            name: "Trem B√£o Cozinha Brasileira",
            color: "#059669",
            bgColor: "#f3f4f6",
            font: "'Inter'",
            fontSize: "16",
            banner: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=800",
            insta: "https://www.instagram.com/trembaocozinhabrasileira/",
            pratos: [
                { id: 1, n: "Feijoada", img: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=300", acc: "Arroz, Couve, Farofa, Laranja, Torresmo" },
                { id: 2, n: "Frango com Quiabo", img: "https://images.unsplash.com/photo-1604908176997-125f25cc6f3d?w=300", acc: "Angu, Arroz, Feij√£o, Salada, Farofa" },
                { id: 3, n: "Moqueca", img: "https://images.unsplash.com/photo-1467003909585-2f8a72700288?w=300", acc: "Pir√£o, Arroz, Farofa, Molho, Salada" },
                { id: 4, n: "Picanha", img: "https://images.unsplash.com/photo-1544025162-d76694265947?w=300", acc: "Batata, Arroz, Vinagrete, Farofa, Feij√£o" }
            ]
        };

        let selPrato = null;
        let selAccs = [];

        function init() {
            document.documentElement.style.setProperty('--p-color', state.color);
            document.documentElement.style.setProperty('--bg-color', state.bgColor);
            document.body.style.fontFamily = state.font;
            document.body.style.fontSize = state.fontSize + "px";
            
            document.getElementById('res-name-display').innerText = state.name;
            document.getElementById('insta-link-display').href = state.insta;
            document.getElementById('header-banner').style.backgroundImage = `url(${state.banner})`;
            
            renderPratos();
            renderAdminPratos();
            checkValidation();
        }

        function renderPratos() {
            const container = document.getElementById('pratos-container');
            container.innerHTML = state.pratos.map(p => `
                <div onclick="selectPrato(${p.id})" id="p-${p.id}" class="bg-white p-3 rounded-2xl shadow-sm flex items-center gap-4 border-2 border-transparent transition-all cursor-pointer">
                    <img src="${p.img}" class="w-24 h-24 rounded-xl object-cover">
                    <span class="font-bold text-lg">${p.n}</span>
                </div>
            `).join('');
        }

        function selectPrato(id) {
            if (localStorage.getItem('sent')) return;
            selPrato = state.pratos.find(p => p.id === id);
            selAccs = [];
            
            document.querySelectorAll('[id^="p-"]').forEach(el => el.classList.add('hidden'));
            const el = document.getElementById(`p-${id}`);
            el.classList.remove('hidden');
            el.classList.add('selected-card');

            document.getElementById('acc-section').classList.remove('hidden');
            const accCont = document.getElementById('acc-container');
            const accList = selPrato.acc.split(',').map(s => s.trim());
            
            accCont.innerHTML = accList.map(a => `
                <label class="flex items-center p-4 bg-white rounded-xl shadow-sm border border-gray-100 cursor-pointer">
                    <input type="checkbox" class="w-6 h-6 mr-3 transition-all" onchange="toggleAcc('${a}')"> 
                    <span class="font-medium">${a}</span>
                </label>
            `).join('');
            checkValidation();
        }

        function toggleAcc(a) {
            const i = selAccs.indexOf(a);
            if (i > -1) selAccs.splice(i, 1); else selAccs.push(a);
            checkValidation();
        }

        function checkValidation() {
            const nome = document.getElementById('client-name').value.trim();
            const btn = document.getElementById('btn-enviar');
            const jaEnviou = localStorage.getItem('sent');

            if (nome.length > 2 && selPrato && selAccs.length > 0 && !jaEnviou) {
                btn.disabled = false;
                btn.style.opacity = "1";
            } else {
                btn.disabled = true;
                btn.style.opacity = "0.5";
            }
        }

        document.getElementById('btn-enviar').addEventListener('click', async () => {
            const btn = document.getElementById('btn-enviar');
            btn.innerText = "‚è≥ ENVIANDO...";
            btn.disabled = true;

            const payload = {
                nome: document.getElementById('client-name').value,
                prato: selPrato.n,
                acompanhamentos: selAccs.join(', '),
                timestamp: new Date().toLocaleString('pt-BR')
            };

            try {
                await fetch(WEBHOOK, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
                localStorage.setItem('sent', 'true');
                alert("Pedido enviado com sucesso para a cozinha!");
                location.reload();
            } catch (e) {
                alert("Erro ao conectar com a planilha.");
                btn.innerText = "Enviar Pedido";
                btn.disabled = false;
            }
        });

        // CMS LOGIC
        function renderAdminPratos() {
            const list = document.getElementById('adm-pratos-list');
            list.innerHTML = state.pratos.map((p, index) => `
                <div class="p-4 bg-white border rounded-xl shadow-inner">
                    <p class="text-xs font-bold text-gray-400 mb-2">PRATO ${index + 1}</p>
                    <input type="text" id="adm-p-n-${p.id}" value="${p.n}" class="w-full p-2 border rounded mb-2 font-bold" placeholder="Nome do prato">
                    <input type="text" id="adm-p-img-${p.id}" value="${p.img}" class="w-full p-2 border rounded mb-2 text-xs text-blue-500" placeholder="URL da imagem">
                    <textarea id="adm-p-acc-${p.id}" class="w-full p-2 border rounded text-sm" rows="2" placeholder="Acompanhamentos (separe por v√≠rgula)">${p.acc}</textarea>
                </div>
            `).join('');
        }

        function checkAdmin() {
            if (prompt("Senha Admin:") === "123") {
                document.getElementById('admin-panel').classList.remove('hidden');
                document.getElementById('adm-name').value = state.name;
                document.getElementById('adm-color-p').value = state.color;
                document.getElementById('adm-color-bg').value = state.bgColor;
                document.getElementById('adm-banner').value = state.banner;
                document.getElementById('adm-insta').value = state.insta;
                document.getElementById('adm-font-size').value = state.fontSize;
                document.getElementById('adm-font').value = state.font;
            }
        }

        function saveAdmin() {
            // Salvar configura√ß√µes gerais
            state.name = document.getElementById('adm-name').value;
            state.color = document.getElementById('adm-color-p').value;
            state.bgColor = document.getElementById('adm-color-bg').value;
            state.banner = document.getElementById('adm-banner').value;
            state.insta = document.getElementById('adm-insta').value;
            state.fontSize = document.getElementById('adm-font-size').value;
            state.font = document.getElementById('adm-font').value;

            // Salvar dados dos pratos
            state.pratos.forEach(p => {
                p.n = document.getElementById(`adm-p-n-${p.id}`).value;
                p.img = document.getElementById(`adm-p-img-${p.id}`).value;
                p.acc = document.getElementById(`adm-p-acc-${p.id}`).value;
            });

            localStorage.setItem('db_menu_v2', JSON.stringify(state));
            alert("‚úÖ Tudo pronto! O site foi atualizado.");
            location.reload();
        }

        function resetSystem() {
            localStorage.removeItem('sent');
            alert("Pedidos liberados!");
            location.reload();
        }

        function toggleAdmin() { document.getElementById('admin-panel').classList.add('hidden'); }
        document.getElementById('client-name').addEventListener('input', checkValidation);
        
        init();
    </script>
</body>
</html>
